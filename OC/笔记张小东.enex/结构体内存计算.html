<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/><meta name="exporter-version" content="Evernote Mac 6.6 (453323)"/><meta name="altitude" content="114.4670333862305"/><meta name="author" content="张小东"/><meta name="created" content="2016-03-25 07:55:13 +0000"/><meta name="latitude" content="34.82027249144884"/><meta name="longitude" content="113.5583881599394"/><meta name="source" content="desktop.mac"/><meta name="updated" content="2016-03-25 07:55:58 +0000"/><title>结构体内存计算</title></head><body>
<div>
<div style="color: rgb(0, 0, 0); font-family: Arial; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18px;">struct A</span></div>
<div style="color: rgb(0, 0, 0); font-family: Arial; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18px;">{</span></div>
<div style="color: rgb(0, 0, 0); font-family: Arial; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18px;">char a;</span></div>
<div style="color: rgb(0, 0, 0); font-family: Arial; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18px;">double b;</span></div>
<div style="color: rgb(0, 0, 0); font-family: Arial; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;"><span style="font-size: 18px;">int c;</span></div>
<div style="color: rgb(0, 0, 0); font-family: Arial; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px;">
<div><span style="font-size: 18px;">};</span></div>
</div>
</div>
<div><span style="font-size: 18px;"><span style="color: rgb(0, 0, 0); font-family: Arial; font-style: normal; font-variant-caps: normal; font-weight: normal; letter-spacing: normal; orphans: auto; text-align: left; text-indent: 0px; text-transform: none; white-space: normal; widows: auto; word-spacing: 0px; -webkit-text-stroke-width: 0px; background-color: rgb(255, 255, 255); float: none;">首先是按照自上向下为结构体分配空间，并在其之间作调整。首先为char分配一个空间，接着编译器为了实现数据的对其，所以在分配double的时候会对之前所分配的空间进行一些调整，调整方式是按照原先分配的空间的大小和当前要分配的大小来决定将要分配的空间，因为double为8字节，所以编译器要求在double之前所分配的空间大小应该是当期要分配的空间的倍数，在这里也就是说在double前面分配的应该是8的倍数空间才行，所以原来的char被迫扩展到8个字节，然后才为double分配8个字节，这样这两个变量就占了16字节。接着就是到了int了，因为int需要4个字节，而前面所分配的为16个字节，是4的倍数，所以接着就为int分配了4个字节，也就是到了目前编译器为这个结构体分配了20个字节，那么是否就是这个答案呢？哈哈，你试一下就知道这个答案不正确，因为这只是其中的一个倍数（按照我所说的两个倍数中的一个），那么还有一个倍数是什么呢？其实还有一个就是前面所说的对结构体整体的一个倍数处理，已经为结构体分配好20个字节空间，那么接下来就是编译器要求整个结构体所分配的空间大小是结构体中占用空间最多的类型所占用空间大小的倍数，如上面的例子，结构体中占用空间最多的就是double这种了类型，那么就要求结构体总大小是这个类型的倍数，在这里也就是要求结构体所占用空间大小要是8 的倍数，因为20不是8的倍数，所以结构体被迫扩展自己的空间，以满足需要，所以就扩展到24个字节。</span></span></div>
</body></html>